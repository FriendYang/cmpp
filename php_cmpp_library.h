/**
 * Generated by build-library.php, Please DO NOT modify!
 */

static char* cmpp_library_source_cmpp2 =
    "\n"
    "namespace Swoole\\Coroutine;\n"
    "\n"
    "class Cmpp2\n"
    "{\n"
    "\n"
    "    private $cmpp = NULL;\n"
    "    private $setting = [];\n"
    "    private $sendChannel = NULL;\n"
    "\n"
    "    public function __construct($set)\n"
    "    {\n"
    "        $this->setting = $set;\n"
    "        if (is_null($this->cmpp)) {\n"
    "            $this->cmpp = new \\Swoole\\Coroutine\\Cmpp($set);\n"
    "        }\n"
    "    }\n"
    "\n"
    "    public function login($ip, $port, $uname, $pwd, float $timeout = -1)\n"
    "    {\n"
    "        $ret = $this->cmpp->login($ip, $port, $uname, $pwd, $timeout);\n"
    "        if (is_array($ret) && $ret['Status'] == 0) {\n"
    "            $this->sendChannel = new \\Swoole\\Coroutine\\Channel(1);\n"
    "            //心跳协程\n"
    "            \\Swoole\\Coroutine::create(function () {\n"
    "                while (1) {\n"
    "                    \\Swoole\\Coroutine::sleep($this->setting['active_test_interval']);\n"
    "                    $pingData = $this->cmpp->activeTest();\n"
    "                    if ($pingData) {\n"
    "                        $this->sendChannel->push($pingData);\n"
    "                    }\n"
    "                }\n"
    "            });\n"
    "            //专门的发送协程\n"
    "            \\Swoole\\Coroutine::create(function () {\n"
    "                while (1) {\n"
    "                    $pack = $this->sendChannel->pop();\n"
    "                    $this->cmpp->sendOnePack($pack);\n"
    "                }\n"
    "            });\n"
    "            true;\n"
    "        } else {\n"
    "            throw new Exception($this->cmpp->errMsg);\n"
    "        }\n"
    "    }\n"
    "\n"
    "    public function submit($mobile, $text, $ext, float $timeout = -1): int\n"
    "    {\n"
    "        $ret = $this->cmpp->submit($mobile, $text, $ext, $timeout);\n"
    "        $this->sendChannel->push($ret['packdata']);\n"
    "        return $ret['sequence_id'];\n"
    "    }\n"
    "\n"
    "    public function recv(float $timeout = -1): array\n"
    "    {\n"
    "        $ret = $this->cmpp->recvOnePack($timeout);\n"
    "        switch ($ret['Command']) {\n"
    "            case CMPP2_ACTIVE_TEST_RESP:\n"
    "            case CMPP2_TERMINATE_RESP:\n"
    "                $this->sendChannel->push($ret[\"packdata\"]);\n"
    "                return $this->recv($timeout);\n"
    "            case CMPP2_DELIVER:\n"
    "                $this->sendChannel->push($ret[\"packdata\"]);\n"
    "                unset($ret[\"packdata\"]);\n"
    "                return $ret;\n"
    "            case CMPP2_SUBMIT_RESP:\n"
    "                return $ret;\n"
    "            default :\n"
    "                throw new Exception(\"error command \" . $ret['Command']);\n"
    "        }\n"
    "    }\n"
    "\n"
    "    public function logout()\n"
    "    {\n"
    "        $this->cmpp->logout();\n"
    "    }\n"
    "\n"
    "}\n"
    "\n"
    "class_alias(\"Swoole\\\\Coroutine\\\\Cmpp2\", \"Co\\\\Cmpp2\", true);\n";

void php_cmpp_load_library();

