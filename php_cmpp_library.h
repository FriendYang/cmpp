/**
 * Generated by build-library.php, Please DO NOT modify!
 */

static char* cmpp_library_source_cmpp2 =
    "\n"
    "namespace Swoole\\Coroutine;\n"
    "\n"
    "class Cmpp2\n"
    "{\n"
    "\n"
    "    private $cmpp = NULL;\n"
    "    private $setting = [];\n"
    "    private $sendChannel = NULL;\n"
    "\n"
    "    public function __construct($set)\n"
    "    {\n"
    "        $this->setting = $set;\n"
    "    }\n"
    "\n"
    "    public function login($ip, $port, $uname, $pwd, float $timeout = -1)\n"
    "    {\n"
    "        if (is_null($this->cmpp)) {\n"
    "            $this->cmpp = new \\Swoole\\Coroutine\\Cmpp($this->setting);\n"
    "            $ret = $this->cmpp->dologin($ip, $port, $uname, $pwd, $timeout);\n"
    "            if (is_array($ret) && $ret['Status'] == 0) {\n"
    "                $this->sendChannel = new \\Swoole\\Coroutine\\Channel(1);\n"
    "                //心跳协程\n"
    "                \\Swoole\\Coroutine::create(function () {\n"
    "                    while (1) {\n"
    "                        \\Swoole\\Coroutine::sleep($this->setting['active_test_interval']);\n"
    "                        if (is_null($this->cmpp)) {\n"
    "                            break; //结束协程\n"
    "                        }\n"
    "                        $pingData = $this->cmpp->activeTest();\n"
    "                        if ($pingData) {\n"
    "                            $this->sendChannel->push($pingData);\n"
    "                        }\n"
    "                    }\n"
    "                });\n"
    "                //专门的发送协程\n"
    "                \\Swoole\\Coroutine::create(function () {\n"
    "                    while (1) {\n"
    "                        $pack = $this->sendChannel->pop();\n"
    "                        if (is_null($this->cmpp)) {\n"
    "                            break; //结束协程\n"
    "                        }\n"
    "                        $this->cmpp->sendOnePack($pack);\n"
    "                    }\n"
    "                });\n"
    "                return $ret;\n"
    "            } else {\n"
    "                $this->errMsg = $this->cmpp->errMsg;\n"
    "                $this->errCode = $this->cmpp->errCode;\n"
    "                return $ret;\n"
    "            }\n"
    "        } else {\n"
    "            $this->errMsg = \"the connection is connected\";\n"
    "            $this->errCode = CMPP_CONN_CONNECTED;\n"
    "            return FALSE;\n"
    "        }\n"
    "    }\n"
    "\n"
    "    public function submit($mobile, $text, $ext, float $timeout = -1, int $udhi = -1)\n"
    "    {\n"
    "        if ($this->cmpp->errCode === CMPP_CONN_BROKEN) {\n"
    "            $this->syncErr();\n"
    "            $this->cmpp = null;\n"
    "            return FALSE;\n"
    "        }\n"
    "        $smsContentLength = mb_strlen($text, 'UTF-8');\n"
    "        if ($smsContentLength <= 70) { // 短短信\n"
    "            $unicode_text = mb_convert_encoding($text, \"UCS-2BE\", \"UTF-8\");\n"
    "            $ret = $this->cmpp->submit($mobile, $unicode_text, $ext);\n"
    "            $cRet = $this->sendChannel->push($ret['packdata'], $timeout);\n"
    "            if ($cRet === FALSE) {\n"
    "                $this->errCode = $this->sendChannel->errCode;\n"
    "                return FALSE;\n"
    "            }\n"
    "            $seqArr[] = $ret['sequence_id'];\n"
    "        } else { //长短信时\n"
    "            if ($udhi == -1 || $udhi >= 255) {\n"
    "                $this->errMsg = \"udhi param error ($udhi)\";\n"
    "                return FALSE;\n"
    "            }\n"
    "            $seqArr = [];\n"
    "            $smsTotalNumber = ceil($smsContentLength / 67);\n"
    "            for ($i = 0; $i < $smsTotalNumber; $i++) {\n"
    "                $content = mb_substr($text, $i * 67, 67, 'UTF-8');\n"
    "                $unicode_text = mb_convert_encoding($content, \"UCS-2BE\", 'UTF-8');\n"
    "                $ret = $this->cmpp->submit($mobile, $unicode_text, $ext, $udhi, $smsTotalNumber, $i + 1);\n"
    "                $cRet = $this->sendChannel->push($ret['packdata'], $timeout);\n"
    "                if ($cRet === FALSE) {\n"
    "                    $this->errCode = $this->sendChannel->errCode;\n"
    "                    return FALSE;\n"
    "                }\n"
    "                $seqArr[] = $ret['sequence_id'];\n"
    "            }\n"
    "        }\n"
    "        return $seqArr;\n"
    "    }\n"
    "\n"
    "    public function recv(float $timeout = -1)\n"
    "    {\n"
    "        $ret = $this->cmpp->recvOnePack($timeout);\n"
    "        if ($ret === false) {\n"
    "            $this->syncErr();\n"
    "            if ($this->errCode === CMPP_CONN_BROKEN) {\n"
    "                $this->cmpp = null;\n"
    "            }\n"
    "            return FALSE;\n"
    "        }\n"
    "        again:\n"
    "        switch ($ret['Command']) {\n"
    "            case CMPP2_ACTIVE_TEST_RESP:\n"
    "            case CMPP2_TERMINATE_RESP:\n"
    "                $this->sendChannel->push($ret[\"packdata\"]);\n"
    "                $ret = $this->cmpp->recvOnePack($timeout);\n"
    "                goto again;\n"
    "            case CMPP2_DELIVER:\n"
    "                $this->sendChannel->push($ret[\"packdata\"]);\n"
    "                unset($ret[\"packdata\"]);\n"
    "                return $ret;\n"
    "            case CMPP2_SUBMIT_RESP:\n"
    "                return $ret;\n"
    "            default :\n"
    "                throw new \\Exception(\"error command \" . $ret['Command']);\n"
    "        }\n"
    "    }\n"
    "\n"
    "    private function syncErr()\n"
    "    {\n"
    "        $this->errCode = $this->cmpp->errCode;\n"
    "        $this->errMsg = $this->cmpp->errMsg;\n"
    "    }\n"
    "\n"
    "    public function logout()\n"
    "    {\n"
    "        $this->cmpp->logout();\n"
    "        $this->cmpp = NULL;\n"
    "    }\n"
    "\n"
    "}\n"
    "\n"
    "class_alias(\"Swoole\\\\Coroutine\\\\Cmpp2\", \"Co\\\\Cmpp2\", true);\n";

void php_cmpp_load_library();

